local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- UI
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "UniversalScriptUI"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 500)
mainFrame.Position = UDim2.new(0.3,0,0.3,0)
mainFrame.BackgroundColor3 = Color3.fromRGB(255,255,255)
mainFrame.BorderColor3 = Color3.fromRGB(0,170,255)
mainFrame.BorderSizePixel = 4
mainFrame.Active = true
mainFrame.Draggable = true

local minimizeBtn = Instance.new("TextButton", mainFrame)
minimizeBtn.Name = "MinimizeBtn"
minimizeBtn.Text = "â€“"
minimizeBtn.Size = UDim2.new(0,30,0,30)
minimizeBtn.Position = UDim2.new(1,-35,0,5)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(230,230,230)
minimizeBtn.TextColor3 = Color3.fromRGB(0,0,0)

local iconFrame = Instance.new("ImageButton", screenGui)
iconFrame.Name = "NadalIcon"
iconFrame.Size = UDim2.new(0,50,0,50)
iconFrame.Position = mainFrame.Position
iconFrame.BackgroundTransparency = 1
iconFrame.Image = "rbxassetid://1234567890"
iconFrame.Visible = false
iconFrame.Active = true
iconFrame.Draggable = true

minimizeBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    iconFrame.Position = mainFrame.Position
    iconFrame.Visible = true
end)
iconFrame.MouseButton1Click:Connect(function()
    mainFrame.Position = iconFrame.Position
    mainFrame.Visible = true
    iconFrame.Visible = false
end)

-- UI Builders
local function createToggleButton(name, text, posY)
    local b = Instance.new("TextButton", mainFrame)
    b.Name, b.Text = name, text..": OFF"
    b.Size, b.Position = UDim2.new(0,260,0,30), UDim2.new(0,20,0,posY)
    b.BackgroundColor3, b.TextColor3 = Color3.fromRGB(240,240,240), Color3.fromRGB(0,0,0)
    b.Font, b.TextSize = Enum.Font.SourceSansBold, 18
    local st = false
    b.MouseButton1Click:Connect(function()
        st = not st
        b.Text = text..": "..(st and "ON" or "OFF")
    end)
    return function() return st end
end

local function createSlider(name, text, posY, min, max, def)
    local lbl = Instance.new("TextLabel", mainFrame)
    lbl.Text = text..": "..def
    lbl.Size, lbl.Position = UDim2.new(0,260,0,20), UDim2.new(0,20,0,posY)
    lbl.BackgroundTransparency, lbl.TextColor3 = 1, Color3.fromRGB(0,0,0)
    lbl.Font, lbl.TextSize = Enum.Font.SourceSansBold, 16

    local s = Instance.new("TextButton", mainFrame)
    s.Name, s.Size = name, UDim2.new(0,260,0,20)
    s.Position = UDim2.new(0,20,0,posY+20)
    s.BackgroundColor3 = Color3.fromRGB(200,200,200)
    local val = def

    s.MouseButton1Down:Connect(function()
        local conn
        conn = RunService.RenderStepped:Connect(function()
            local m = Players.LocalPlayer:GetMouse()
            local rel = m.X - s.AbsolutePosition.X
            local pct = math.clamp(rel/s.AbsoluteSize.X,0,1)
            val = math.floor(min + (max-min)*pct)
            lbl.Text = text..": "..val
        end)
        s.MouseButton1Up:Wait()
        if conn then conn:Disconnect() end
    end)
    return function() return val end
end

-- Create UI controls
local y=40
local getESP = createToggleButton("ESPBtn","ESP",y); y+=40
local getAimbot = createToggleButton("AimBtn","Aimbot",y); y+=40
local getHitbox = createToggleButton("HitBtn","Hitbox",y); y+=40
local getTracer = createToggleButton("TraceBtn","Tracer",y); y+=40
local getBox = createToggleButton("BoxBtn","Box",y); y+=40
local getTeam = createToggleButton("TeamChkBtn","Team Check",y); y+=40
local getRGB = createToggleButton("RGBBtn","RGB",y); y+=40
y+=10
local getFOV = createSlider("FOVSlider","FOV",y,50,500,150); y+=50
local getMag = createSlider("MagSlider","Mag",y,100,3000,1000)

-- ESP Logic
local espObjs = {}
local function drawESP(p)
    if p==LocalPlayer then return end
    local c = p.Character
    local root=p.Character and p.Character:FindFirstChild("HumanoidRootPart")
    local hum = root and p.Character:FindFirstChildOfClass("Humanoid")
    if not root or not hum then return end
    if not espObjs[p] then
        espObjs[p] = {
            Box=Drawing.new("Square"), Tracer=Drawing.new("Line"),
            Name=Drawing.new("Text"), Health=Drawing.new("Text"),
            Mag=Drawing.new("Text")
        }
    end
    local objs=espObjs[p]
    local pos,ons=Camera:WorldToViewportPoint(root.Position)
    if ons and getESP() and (not getTeam() or p.Team~=LocalPlayer.Team) then
        local dist=(LocalPlayer.Character.HumanoidRootPart.Position-root.Position).Magnitude
        if dist > getMag() then for _,o in pairs(objs) do o.Visible=false end return end
        local col = getRGB() and Color3.fromHSV(tick()%5/5,1,1) or Color3.fromRGB(0,255,0)
        objs.Box.Visible, objs.Box.Color = getBox(), col
        objs.Box.Thickness, objs.Box.Size = 1, Vector2.new(40,80)
        objs.Box.Position = Vector2.new(pos.X-20,pos.Y-40)

        objs.Tracer.Visible, objs.Tracer.Color = getTracer(), col
        objs.Tracer.Thickness = 1
        objs.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
        objs.Tracer.To = Vector2.new(pos.X,pos.Y)

        objs.Name.Visible=true
        objs.Name.Text=p.Name
        objs.Name.Color=Color3.new(1,1,1)
        objs.Name.Size=13
        objs.Name.Position=Vector2.new(pos.X-20,pos.Y-55)
        objs.Name.Center=false
        objs.Name.Outline=true

        objs.Health.Visible=true
        objs.Health.Text="HP: "..math.floor(hum.Health)
        objs.Health.Color=Color3.new(0,1,0)
        objs.Health.Size=13
        objs.Health.Position=Vector2.new(pos.X-20,pos.Y+40)
        objs.Health.Center=false
        objs.Health.Outline=true

        objs.Mag.Visible=true
        objs.Mag.Text=math.floor(dist).." studs"
        objs.Mag.Color=Color3.new(1,1,1)
        objs.Mag.Size=13
        objs.Mag.Position=Vector2.new(pos.X-20,pos.Y+55)
        objs.Mag.Center=false
        objs.Mag.Outline=true
    else
        for _,o in pairs(espObjs[p]) do o.Visible=false end
    end
end

Players.PlayerRemoving:Connect(function(p)
    if espObjs[p] then for _,o in pairs(espObjs[p]) do o:Remove() end espObjs[p]=nil end
end)

RunService.RenderStepped:Connect(function()
    for _,p in pairs(Players:GetPlayers()) do drawESP(p) end
end)

-- Aimbot
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness, fovCircle.Filled = 2, false
fovCircle.Position=Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

local function getClosest()
    local close,sd=nil,math.huge
    for _,p in pairs(Players:GetPlayers()) do
        if p~=LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChildOfClass("Humanoid") then
            if getTeam() and p.Team==LocalPlayer.Team then continue end
            local pos,ons = Camera:WorldToViewportPoint(p.Character.HumanoidRootPart.Position)
            if ons then
                local d=(Vector2.new(pos.X,pos.Y)-fovCircle.Position).Magnitude
                if d < fovCircle.Radius and d < sd and p.Character:FindFirstChildOfClass("Humanoid").Health>0 then
                    sd,d,close = d,d,p
                end
            end
        end
    end
    return close
end

RunService.RenderStepped:Connect(function()
    fovCircle.Radius, fovCircle.Position = getFOV(), Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    fovCircle.Color = getRGB() and Color3.fromHSV(tick()%5/5,1,1) or Color3.fromRGB(255,255,255)
    fovCircle.Visible = getAimbot()
    if getAimbot() then
        local tgt = getClosest()
        if tgt and tgt.Character and tgt.Character:FindFirstChild("HumanoidRootPart") then
            local aimPos = tgt.Character.HumanoidRootPart.Position + Vector3.new(0,1.5,0)
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, aimPos)
        end
    end
end)

-- Hitbox Expander
local origS = {}
RunService.RenderStepped:Connect(function()
    if getHitbox() then
        for _,p in pairs(Players:GetPlayers()) do
            if p~=LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local root = p.Character.HumanoidRootPart
                if not origS[p] then origS[p] = root.Size end
                root.Size = Vector3.new(10,10,10)
                root.Transparency, root.Material = 0.6, Enum.Material.Neon
                root.BrickColor = BrickColor.new("Really red")
                root.CanCollide = false
            end
        end
    else
        for p,s in pairs(origS) do
            if p and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local root = p.Character.HumanoidRootPart
                root.Size = s
                root.Transparency, root.Material = 1, Enum.Material.Plastic
                root.CanCollide = false
            end
        end
    end
end)
Players.PlayerRemoving:Connect(function(p) origS[p]=nil end)
